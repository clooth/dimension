var Collections;!function(a){function b(a,b){return b>a?-1:a===b?0:1}function c(a,b){return a===b}function d(b){return null===b?"COLLECTION_NULL":a.isUndefined(b)?"COLLECTION_UNDEFINED":a.isString(b)?b:b.toString()}function e(b,c){if("undefined"==typeof c&&(c=","),null===b)return"COLLECTION_NULL";if(a.isUndefined(b))return"COLLECTION_UNDEFINED";if(a.isString(b))return b.toString();var d="{",e=!0;for(var f in b)b.hasOwnProperty(f)&&(e?e=!1:d+=c,d=d+f+":"+b[f]);return d+"}"}function f(a){return"function"==typeof a}function g(a){return"undefined"==typeof a}function h(a){return"[object String]"===Object.prototype.toString.call(a)}function i(b){return a.isFunction(b)?function(a,c){return-1*b(a,c)}:function(a,b){return b>a?1:a===b?0:-1}}function j(a){return function(b,c){return 0===a(b,c)}}function k(b,c){if(null==b||"object"!=typeof b)return b;if(void 0==c)c=[];else{var d,e=c.length;for(d=0;e>d;d++)if(b===c[d])return b}if(c.push(b),"function"==typeof b.clone)return b.clone(!0);if("[object Array]"==Object.prototype.toString.call(b)){g=b.slice();for(var d=g.length;d--;)g[d]=k(g[d],c);return g}if(b instanceof Date)return new Date(b.getTime());if(b instanceof RegExp)return new RegExp(b);if(b.nodeType&&"function"==typeof b.cloneNode)return b.cloneNode(!0);var f=Object.getPrototypeOf?Object.getPrototypeOf(b):b.__proto__;f||(f=b.constructor.prototype);var g=l(f);for(var h in b)g[h]=a.deepCopy(b[h],c);return g}a.defaultCompare=b,a.defaultEquals=c,a.defaultToString=d,a.makeString=e,a.isFunction=f,a.isUndefined=g,a.isString=h,a.reverseCompareFunction=i,a.compareToEquals=j,a.deepCopy=k;var l=Object.create;"function"!=typeof l&&(l=function(a){function b(){}return b.prototype=a,new b}),function(b){function c(b,c,d){for(var e=d||a.defaultEquals,f=b.length,g=0;f>g;g++)if(e(b[g],c))return g;return-1}function d(b,c,d){for(var e=d||a.defaultEquals,f=b.length,g=f-1;g>=0;g--)if(e(b[g],c))return g;return-1}function e(a,c,d){return b.indexOf(a,c,d)>=0}function f(a,c,d){var e=b.indexOf(a,c,d);return 0>e?!1:(a.splice(e,1),!0)}function g(b,c,d){for(var e=d||a.defaultEquals,f=b.length,g=0,h=0;f>h;h++)e(b[h],c)&&g++;return g}function h(b,c,d){var e=d||a.defaultEquals;if(b.length!==c.length)return!1;for(var f=b.length,g=0;f>g;g++)if(!e(b[g],c[g]))return!1;return!0}function i(a){return a.concat()}function j(a,b,c){if(0>b||b>=a.length||0>c||c>=a.length)return!1;var d=a[b];return a[b]=a[c],a[c]=d,!0}function k(a){return"["+a.toString()+"]"}function l(a,b){for(var c=a.length,d=0;c>d;d++)if(b(a[d])===!1)return}b.indexOf=c,b.lastIndexOf=d,b.contains=e,b.remove=f,b.frequency=g,b.equals=h,b.copy=i,b.swap=j,b.toString=k,b.forEach=l}(a.arrays||(a.arrays={}));var m=(a.arrays,function(){function b(){this.firstNode=null,this.lastNode=null,this.nElements=0}return b.prototype.add=function(b,c){if(a.isUndefined(c)&&(c=this.nElements),0>c||c>this.nElements||a.isUndefined(b))return!1;var d=this.createNode(b);if(0===this.nElements)this.firstNode=d,this.lastNode=d;else if(c===this.nElements)this.lastNode.next=d,this.lastNode=d;else if(0===c)d.next=this.firstNode,this.firstNode=d;else{var e=this.nodeAtIndex(c-1);d.next=e.next,e.next=d}return this.nElements++,!0},b.prototype.first=function(){return null!==this.firstNode?this.firstNode.element:void 0},b.prototype.last=function(){return null!==this.lastNode?this.lastNode.element:void 0},b.prototype.elementAtIndex=function(a){var b=this.nodeAtIndex(a);return null===b?void 0:b.element},b.prototype.indexOf=function(b,c){var d=c||a.defaultEquals;if(a.isUndefined(b))return-1;for(var e=this.firstNode,f=0;null!==e;){if(d(e.element,b))return f;f++,e=e.next}return-1},b.prototype.contains=function(a,b){return this.indexOf(a,b)>=0},b.prototype.remove=function(b,c){var d=c||a.defaultEquals;if(this.nElements<1||a.isUndefined(b))return!1;for(var e=null,f=this.firstNode;null!==f;){if(d(f.element,b))return f===this.firstNode?(this.firstNode=this.firstNode.next,f===this.lastNode&&(this.lastNode=null)):f===this.lastNode?(this.lastNode=e,e.next=f.next,f.next=null):(e.next=f.next,f.next=null),this.nElements--,!0;e=f,f=f.next}return!1},b.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},b.prototype.equals=function(b,c){var d=c||a.defaultEquals;return b instanceof a.LinkedList?this.size()!==b.size()?!1:this.equalsAux(this.firstNode,b.firstNode,d):!1},b.prototype.equalsAux=function(a,b,c){for(;null!==a;){if(!c(a.element,b.element))return!1;a=a.next,b=b.next}return!0},b.prototype.removeElementAtIndex=function(a){if(0>a||a>=this.nElements)return void 0;var b;if(1===this.nElements)b=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var c=this.nodeAtIndex(a-1);null===c?(b=this.firstNode.element,this.firstNode=this.firstNode.next):c.next===this.lastNode&&(b=this.lastNode.element,this.lastNode=c),null!==c&&(b=c.next.element,c.next=c.next.next)}return this.nElements--,b},b.prototype.forEach=function(a){for(var b=this.firstNode;null!==b&&a(b.element)!==!1;)b=b.next},b.prototype.reverse=function(){for(var a=null,b=this.firstNode,c=null;null!==b;)c=b.next,b.next=a,a=b,b=c;c=this.firstNode,this.firstNode=this.lastNode,this.lastNode=c},b.prototype.toArray=function(){for(var a=[],b=this.firstNode;null!==b;)a.push(b.element),b=b.next;return a},b.prototype.size=function(){return this.nElements},b.prototype.isEmpty=function(){return this.nElements<=0},b.prototype.toString=function(){return a.arrays.toString(this.toArray())},b.prototype.nodeAtIndex=function(a){if(0>a||a>=this.nElements)return null;if(a===this.nElements-1)return this.lastNode;for(var b=this.firstNode,c=0;a>c;c++)b=b.next;return b},b.prototype.createNode=function(a){return{element:a,next:null}},b}());a.LinkedList=m;var n=function(){function b(b){this.table={},this.nElements=0,this.toStr=b||a.defaultToString}return b.prototype.getValue=function(b){var c=this.table[this.toStr(b)];return a.isUndefined(c)?void 0:c.value},b.prototype.copyValue=function(b){var c=this.getValue(b);return a.deepCopy(c)},b.prototype.setValue=function(b,c){if(a.isUndefined(b)||a.isUndefined(c))return void 0;var d,e=this.toStr(b),f=this.table[e];return a.isUndefined(f)?(this.nElements++,d=void 0):d=f.value,this.table[e]={key:b,value:c},d},b.prototype.remove=function(b){var c=this.toStr(b),d=this.table[c];return a.isUndefined(d)?void 0:(delete this.table[c],this.nElements--,d.value)},b.prototype.keys=function(){var a=[];for(var b in this.table)if(this.table.hasOwnProperty(b)){var c=this.table[b];a.push(c.key)}return a},b.prototype.values=function(){var a=[];for(var b in this.table)if(this.table.hasOwnProperty(b)){var c=this.table[b];a.push(c.value)}return a},b.prototype.forEach=function(a){for(var b in this.table)if(this.table.hasOwnProperty(b)){var c=this.table[b],d=a(c.key,c.value);if(d===!1)return}},b.prototype.containsKey=function(b){return!a.isUndefined(this.getValue(b))},b.prototype.clear=function(){this.table={},this.nElements=0},b.prototype.size=function(){return this.nElements},b.prototype.isEmpty=function(){return this.nElements<=0},b.prototype.toString=function(){var a="{";return this.forEach(function(b,c){a=a+"\n	"+b.toString()+" : "+c.toString()}),a+"\n}"},b}();a.Dictionary=n;var o=function(){function b(b,c,d){"undefined"==typeof d&&(d=!1),this.dict=new n(b),this.equalsF=c||a.defaultEquals,this.allowDuplicate=d}return b.prototype.getValue=function(b){var c=this.dict.getValue(b);return a.isUndefined(c)?[]:a.arrays.copy(c)},b.prototype.setValue=function(b,c){if(a.isUndefined(b)||a.isUndefined(c))return!1;if(!this.containsKey(b))return this.dict.setValue(b,[c]),!0;var d=this.dict.getValue(b);return!this.allowDuplicate&&a.arrays.contains(d,c,this.equalsF)?!1:(d.push(c),!0)},b.prototype.remove=function(b,c){if(a.isUndefined(c)){var d=this.dict.remove(b);return!a.isUndefined(d)}var e=this.dict.getValue(b);return a.arrays.remove(e,c,this.equalsF)?(0===e.length&&this.dict.remove(b),!0):!1},b.prototype.keys=function(){return this.dict.keys()},b.prototype.values=function(){for(var a=this.dict.values(),b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++)b.push(d[e]);return b},b.prototype.containsKey=function(a){return this.dict.containsKey(a)},b.prototype.clear=function(){this.dict.clear()},b.prototype.size=function(){return this.dict.size()},b.prototype.isEmpty=function(){return this.dict.isEmpty()},b}();a.MultiDictionary=o;var p=function(){function b(b){this.data=[],this.compare=b||a.defaultCompare}return b.prototype.leftChildIndex=function(a){return 2*a+1},b.prototype.rightChildIndex=function(a){return 2*a+2},b.prototype.parentIndex=function(a){return Math.floor((a-1)/2)},b.prototype.minIndex=function(a,b){return b>=this.data.length?a>=this.data.length?-1:a:this.compare(this.data[a],this.data[b])<=0?a:b},b.prototype.siftUp=function(b){for(var c=this.parentIndex(b);b>0&&this.compare(this.data[c],this.data[b])>0;)a.arrays.swap(this.data,c,b),b=c,c=this.parentIndex(b)},b.prototype.siftDown=function(b){for(var c=this.minIndex(this.leftChildIndex(b),this.rightChildIndex(b));c>=0&&this.compare(this.data[b],this.data[c])>0;)a.arrays.swap(this.data,c,b),b=c,c=this.minIndex(this.leftChildIndex(b),this.rightChildIndex(b))},b.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},b.prototype.add=function(b){return a.isUndefined(b)?void 0:(this.data.push(b),this.siftUp(this.data.length-1),!0)},b.prototype.removeRoot=function(){if(this.data.length>0){var a=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),a}return void 0},b.prototype.contains=function(b){var c=a.compareToEquals(this.compare);return a.arrays.contains(this.data,b,c)},b.prototype.size=function(){return this.data.length},b.prototype.isEmpty=function(){return this.data.length<=0},b.prototype.clear=function(){this.data.length=0},b.prototype.forEach=function(b){a.arrays.forEach(this.data,b)},b}();a.Heap=p;var q=function(){function a(){this.list=new m}return a.prototype.push=function(a){return this.list.add(a,0)},a.prototype.add=function(a){return this.list.add(a,0)},a.prototype.pop=function(){return this.list.removeElementAtIndex(0)},a.prototype.peek=function(){return this.list.first()},a.prototype.size=function(){return this.list.size()},a.prototype.contains=function(a,b){return this.list.contains(a,b)},a.prototype.isEmpty=function(){return this.list.isEmpty()},a.prototype.clear=function(){this.list.clear()},a.prototype.forEach=function(a){this.list.forEach(a)},a}();a.Stack=q;var r=function(){function a(){this.list=new m}return a.prototype.enqueue=function(a){return this.list.add(a)},a.prototype.add=function(a){return this.list.add(a)},a.prototype.dequeue=function(){if(0!==this.list.size()){var a=this.list.first();return this.list.removeElementAtIndex(0),a}return void 0},a.prototype.peek=function(){return 0!==this.list.size()?this.list.first():void 0},a.prototype.size=function(){return this.list.size()},a.prototype.contains=function(a,b){return this.list.contains(a,b)},a.prototype.isEmpty=function(){return this.list.size()<=0},a.prototype.clear=function(){this.list.clear()},a.prototype.forEach=function(a){this.list.forEach(a)},a}();a.Queue=r;var s=function(){function b(b){this.heap=new p(a.reverseCompareFunction(b))}return b.prototype.enqueue=function(a){return this.heap.add(a)},b.prototype.add=function(a){return this.heap.add(a)},b.prototype.dequeue=function(){if(0!==this.heap.size()){var a=this.heap.peek();return this.heap.removeRoot(),a}return void 0},b.prototype.peek=function(){return this.heap.peek()},b.prototype.contains=function(a){return this.heap.contains(a)},b.prototype.isEmpty=function(){return this.heap.isEmpty()},b.prototype.size=function(){return this.heap.size()},b.prototype.clear=function(){this.heap.clear()},b.prototype.forEach=function(a){this.heap.forEach(a)},b}();a.PriorityQueue=s;var t=function(){function b(a){this.dictionary=new n(a)}return b.prototype.contains=function(a){return this.dictionary.containsKey(a)},b.prototype.add=function(b){return this.contains(b)||a.isUndefined(b)?!1:(this.dictionary.setValue(b,b),!0)},b.prototype.intersection=function(a){var b=this;this.forEach(function(c){return a.contains(c)||b.remove(c),!0})},b.prototype.union=function(a){var b=this;a.forEach(function(a){return b.add(a),!0})},b.prototype.difference=function(a){var b=this;a.forEach(function(a){return b.remove(a),!0})},b.prototype.isSubsetOf=function(a){if(this.size()>a.size())return!1;var b=!0;return this.forEach(function(c){return a.contains(c)?!0:(b=!1,!1)}),b},b.prototype.remove=function(a){return this.contains(a)?(this.dictionary.remove(a),!0):!1},b.prototype.forEach=function(a){this.dictionary.forEach(function(b,c){return a(c)})},b.prototype.toArray=function(){return this.dictionary.values()},b.prototype.isEmpty=function(){return this.dictionary.isEmpty()},b.prototype.size=function(){return this.dictionary.size()},b.prototype.clear=function(){this.dictionary.clear()},b.prototype.toString=function(){return a.arrays.toString(this.toArray())},b}();a.Set=t;var u=function(){function b(b){this.toStrF=b||a.defaultToString,this.dictionary=new n(this.toStrF),this.nElements=0}return b.prototype.add=function(b,c){if("undefined"==typeof c&&(c=1),a.isUndefined(b)||0>=c)return!1;if(this.contains(b))this.dictionary.getValue(b).copies+=c;else{var d={value:b,copies:c};this.dictionary.setValue(b,d)}return this.nElements+=c,!0},b.prototype.count=function(a){return this.contains(a)?this.dictionary.getValue(a).copies:0},b.prototype.contains=function(a){return this.dictionary.containsKey(a)},b.prototype.remove=function(b,c){if("undefined"==typeof c&&(c=1),a.isUndefined(b)||0>=c)return!1;if(this.contains(b)){var d=this.dictionary.getValue(b);return this.nElements-=c>d.copies?d.copies:c,d.copies-=c,d.copies<=0&&this.dictionary.remove(b),!0}return!1},b.prototype.toArray=function(){for(var a=[],b=this.dictionary.values(),c=b.length,d=0;c>d;d++)for(var e=b[d],f=e.value,g=e.copies,h=0;g>h;h++)a.push(f);return a},b.prototype.toSet=function(){for(var a=new t(this.toStrF),b=this.dictionary.values(),c=b.length,d=0;c>d;d++){var e=b[d].value;a.add(e)}return a},b.prototype.forEach=function(a){this.dictionary.forEach(function(b,c){for(var d=c.value,e=c.copies,f=0;e>f;f++)if(a(d)===!1)return!1;return!0})},b.prototype.size=function(){return this.nElements},b.prototype.isEmpty=function(){return 0===this.nElements},b.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},b}();a.Bag=u;var v=function(){function b(b){this.root=null,this.compare=b||a.defaultCompare,this.nElements=0}return b.prototype.add=function(b){return a.isUndefined(b)?!1:null!==this.insertNode(this.createNode(b))?(this.nElements++,!0):!1},b.prototype.clear=function(){this.root=null,this.nElements=0},b.prototype.isEmpty=function(){return 0===this.nElements},b.prototype.size=function(){return this.nElements},b.prototype.contains=function(b){return a.isUndefined(b)?!1:null!==this.searchNode(this.root,b)},b.prototype.remove=function(a){var b=this.searchNode(this.root,a);return null===b?!1:(this.removeNode(b),this.nElements--,!0)},b.prototype.inorderTraversal=function(a){this.inorderTraversalAux(this.root,a,{stop:!1})},b.prototype.preorderTraversal=function(a){this.preorderTraversalAux(this.root,a,{stop:!1})},b.prototype.postorderTraversal=function(a){this.postorderTraversalAux(this.root,a,{stop:!1})},b.prototype.levelTraversal=function(a){this.levelTraversalAux(this.root,a)},b.prototype.minimum=function(){return this.isEmpty()?void 0:this.minimumAux(this.root).element},b.prototype.maximum=function(){return this.isEmpty()?void 0:this.maximumAux(this.root).element},b.prototype.forEach=function(a){this.inorderTraversal(a)},b.prototype.toArray=function(){var a=[];return this.inorderTraversal(function(b){return a.push(b),!0}),a},b.prototype.height=function(){return this.heightAux(this.root)},b.prototype.searchNode=function(a,b){for(var c=null;null!==a&&0!==c;)c=this.compare(b,a.element),0>c?a=a.leftCh:c>0&&(a=a.rightCh);return a},b.prototype.transplant=function(a,b){null===a.parent?this.root=b:a===a.parent.leftCh?a.parent.leftCh=b:a.parent.rightCh=b,null!==b&&(b.parent=a.parent)},b.prototype.removeNode=function(a){if(null===a.leftCh)this.transplant(a,a.rightCh);else if(null===a.rightCh)this.transplant(a,a.leftCh);else{var b=this.minimumAux(a.rightCh);b.parent!==a&&(this.transplant(b,b.rightCh),b.rightCh=a.rightCh,b.rightCh.parent=b),this.transplant(a,b),b.leftCh=a.leftCh,b.leftCh.parent=b}},b.prototype.inorderTraversalAux=function(a,b,c){null===a||c.stop||(this.inorderTraversalAux(a.leftCh,b,c),c.stop||(c.stop=b(a.element)===!1,c.stop||this.inorderTraversalAux(a.rightCh,b,c)))},b.prototype.levelTraversalAux=function(a,b){var c=new r;for(null!==a&&c.enqueue(a);!c.isEmpty();){if(a=c.dequeue(),b(a.element)===!1)return;null!==a.leftCh&&c.enqueue(a.leftCh),null!==a.rightCh&&c.enqueue(a.rightCh)}},b.prototype.preorderTraversalAux=function(a,b,c){null===a||c.stop||(c.stop=b(a.element)===!1,c.stop||(this.preorderTraversalAux(a.leftCh,b,c),c.stop||this.preorderTraversalAux(a.rightCh,b,c)))},b.prototype.postorderTraversalAux=function(a,b,c){null===a||c.stop||(this.postorderTraversalAux(a.leftCh,b,c),c.stop||(this.postorderTraversalAux(a.rightCh,b,c),c.stop||(c.stop=b(a.element)===!1)))},b.prototype.minimumAux=function(a){for(;null!==a.leftCh;)a=a.leftCh;return a},b.prototype.maximumAux=function(a){for(;null!==a.rightCh;)a=a.rightCh;return a},b.prototype.heightAux=function(a){return null===a?-1:Math.max(this.heightAux(a.leftCh),this.heightAux(a.rightCh))+1},b.prototype.insertNode=function(a){for(var b=null,c=this.root,d=null;null!==c;){if(d=this.compare(a.element,c.element),0===d)return null;0>d?(b=c,c=c.leftCh):(b=c,c=c.rightCh)}return a.parent=b,null===b?this.root=a:this.compare(a.element,b.element)<0?b.leftCh=a:b.rightCh=a,a},b.prototype.createNode=function(a){return{element:a,leftCh:null,rightCh:null,parent:null}},b}();a.BSTree=v}(Collections||(Collections={}));var Dimension;!function(a){var b=function(){function a(){}return a.prototype.getTrigger=function(a){switch(a){case 0:return this.onAttack;case 1:return this.onDamage;case 2:return this.onDamageDealt;case 3:return this.onStartOfTurn;case 4:return this.onEndOfTurn;case 5:return this.onDeath;case 6:return this.onCast;case 7:return this.onHeal;case 8:return this.onDraw;case 9:return this.onSecretRevealed;case 10:return this.onSummon}return null},a.prototype.applyToAura=function(a){a.onCast=this.onCast,a.onDamage=this.onDamage,a.onDamageDealt=this.onDamageDealt,a.onDeath=this.onDeath,a.onStartOfTurn=this.onStartOfTurn,a.onEndOfTurn=this.onEndOfTurn,a.onHeal=this.onHeal,a.onDraw=this.onDraw,a.onAttack=this.onAttack,a.onSecretRevealed=this.onSecretRevealed,a.onSummon=this.onSummon},a}();a.Triggerable=b}(Dimension||(Dimension={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Dimension;!function(a){var b=function(a){function b(b,c,d,e){a.call(this),this.expires=!1,this.stat=0,this.amount=0,this.dynamic=!1,this.owner=b,this.stat=c,this.amount=d,this.expires=e,this.dynamic=!1}return __extends(b,a),b.createDynamic=function(a,c,d,e){var f=new b(a,c,0,e);return f.calculation=d,f.dynamic=!0,f},b.createTriggerable=function(a,c){var d=new b(a,null,0,!1);return d.onTrigger=c,d},b.prototype.amountFor=function(a){return this.dynamic?this.owner.game.invoke(this.calculation,a,null):this.amount},b.prototype.trigger=function(a){this.owner.game.removeAura(this),this.owner.secrets.remove(this),this.owner.onEvent(9,this,a),this.owner.game.invoke(this.onTrigger,this.owner,a)},b}(a.Triggerable);a.Aura=b}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(){function a(a,b,c){this.event=a,this.source=b,this.other=c}return a.prototype.toString=function(){return this.event+" "+this.source+" "+this.other},a}(),c=function(){function c(a){this.eventStack=[],this.auras=new Collections.LinkedList,this.game=a}return c.prototype.getController=function(){return null==this.controller?this.owner:this.controller},c.prototype.runEvent=function(a,b,c){for(var d=this.getAuras(),e=0,f=d.length;f>e;e++)this.game.aura=d[e],this.game.invoke(d[e].getTrigger(a),b,c)},c.prototype.onEvent=function(a,c,d){if(this.eventStack.push(new b(a,c,d)),!(this.eventStack.length>1))for(;this.eventStack.length>0;){var e=this.eventStack.shift();this.handleRunEvent(e)}},c.prototype.handleRunEvent=function(a){this.runEvent(a.event,a.source,a.other),this.removeObject(a,this.eventStack)},c.prototype.addAura=function(b,c,d,e){"undefined"==typeof e&&(e=!1);var f=new a.Aura(this,b,c,d);return e?this.game.globalAuras.add(f):this.auras.add(f),f},c.prototype.addDynamicAura=function(b,c,d,e){"undefined"==typeof e&&(e=!1);var f=a.Aura.createDynamic(this,b,c,d);return e?this.game.globalAuras.add(f):this.auras.add(f),f},c.prototype.addAuraFromCard=function(b){var c=new a.Aura(this,0,0,!1);return b.applyToAura(c),this.auras.add(c),c},c.prototype.removeAuras=function(){this.auras.clear();for(var a=this.game.globalAuras,b=0,c=a.size();c>b;b++)a[b].owner==this&&this.removeObject(a[b],this.game.globalAuras)},c.prototype.getAuras=function(){var a=[];return a=a.concat(this.auras.toArray()),a=a.concat(this.getController().secrets.toArray()),a=a.concat(this.getController().opponent.secrets.toArray()),a=a.concat(this.game.globalAuras.toArray())},c.prototype.aurasByStat=function(a){for(var b=[],c=this.getAuras(),d=0,e=c.length;e>d;d++)c[d].stat==a&&b.push(c[d]);return b},c.prototype.sumAurasByStat=function(){var a=0;return a},c.prototype.removeObject=function(a,b){var c=b.indexOf(a,0);void 0!=c&&b.splice(c,1)},c}();a.GameObject=c}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(a){function b(b){a.call(this,b),this.armor=0,this.attackCount=0,this.frozen=0,this.windfury=!1,this.divineShield=!1,this.stealth=!1}return __extends(b,a),b.prototype.getAttack=function(){return Math.max(0,this.attack+this.sumAurasByStat(1))},b.prototype.getHealth=function(){return Math.max(0,this.health+this.sumAurasByStat(2))},b.prototype.isDamaged=function(){return this.getHealth()<this.maxHealth},b.prototype.combatDamage=function(a){if(0>a)return!1;if(this.divineShield)return this.divineShield=!1,!1;var b=Math.min(a,this.armor);return this.armor-=b,a-=b,this.health-=a,a>0},b.prototype.damage=function(a,b,c){if("undefined"==typeof c&&(c=!1),c&&(a+=b.owner.sumAurasByStat(9)),!(0>a)){var d=this.combatDamage(a,b);d&&(this.onEvent(1,this,b),this.game.postDamage())}},b.prototype.destroy=function(){this.health=-1e3,this.game.postDamage()},b.prototype.heal=function(a){a=Math.min(a,Math.max(this.maxHealth-this.getHealth(),0)),a>0&&(this.health+=a,this.onEvent(7,this,null))},b.prototype.gain=function(a,b){this.getHealth()<=0||(this.attack+=a,this.health+=b)},b.prototype.freeze=function(){this.freezeForTurns(1)},b.prototype.freezeForTurns=function(a){this.frozen=Math.max(a,this.frozen)},b.prototype.isFrozen=function(){return this.frozen>0},b.prototype.unfreeze=function(){this.frozen>0&&this.frozen--},b}(a.GameObject);a.Character=b}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(b){function c(a,c,d,e,f){b.call(this,f.game),this.token=!1,this.sick=!0,this.charge=!1,this.taunt=!1,this.defender=!1,this.shroud=!1,this.controller=this.owner=f,this.name=a,this.attack=c,this.health=d,this.maxHealth=d,null!=e&&(this.card=e,this.token=e.token,this.charge=e.charge,this.defender=e.defender,this.taunt=e.taunt,this.divineShield=e.divineShield,this.windfury=e.windfury,this.stealth=e.stealth,this.shroud=e.shroud,this.addAuraFromCard(e))}return __extends(c,b),c.prototype.onEvent=function(a,c,d){b.prototype.onEvent.call(this,a,c,d),5==a&&this.removeAuras()},c.prototype.silence=function(){this.taunt=!1,this.charge=!1,this.windfury=!1,this.divineShield=!1,this.stealth=!1,this.shroud=!1,this.removeAuras()},c.prototype.hasCharge=function(){return this.sumAurasByStat(5)>0?!0:this.charge},c.prototype.hasWindfury=function(){return this.sumAurasByStat(6)>0?!0:this.windfury},c.prototype.isAdjacentTo=function(a){var b=this.controller.board.indexOf(this),c=this.controller.board.indexOf(a);return-1==c?!1:1==Math.abs(b-c)?!0:!1},c.prototype.forEachNeighbor=function(a){var b=this.controller.board.indexOf(this),c=b+1;c<this.controller.board.length&&this.game.invoke(a,this.controller.board[c],null);var d=b-1;d>=0&&this.game.invoke(a,this.controller.board[d],null)},c.prototype.transform=function(b){var c=a.Card.get(b);this.removeAuras(),this.card=c,this.name=b,this.attack=c.attack,this.health=c.health,this.maxHealth=c.health,this.charge=c.charge,this.defender=c.defender,this.taunt=c.taunt,this.divineShield=c.divineShield,this.windfury=c.windfury,this.stealth=c.stealth,this.shroud=c.shroud},c}(a.Character);a.Minion=b}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(b){function c(c,d){b.call(this,c),this.library=new Collections.LinkedList,this.hand=new Collections.LinkedList,this.secrets=new Collections.LinkedList,this.board=new Array,this.mana=0,this.maxMana=0,this.overload=0,this.weapon=null,this.controller=this.owner=this,this.health=30,this.maxHealth=30,this.attack=0,this.ability=a.Card.get(d.hero),this.deck=d;for(var e=0,f=d.spells.size();f>e;e++)this.library.add(new a.Spell(d.spells[e],this))}return __extends(c,b),c.prototype.getAttack=function(){return b.prototype.getAttack.call(this)+(null!=this.weapon?this.weapon.getAttack():0)},c.prototype.getMana=function(){return Math.max(0,Math.min(this.getMaxMana(),this.mana+this.sumAurasByStat(3)))},c.prototype.getMaxMana=function(){return Math.max(0,Math.min(10,this.maxMana+this.sumAurasByStat(3)))},c.prototype.gainMana=function(a){this.mana=Math.max(this.maxMana,this.mana+a)},c.prototype.gainManaCrystals=function(a){this.maxMana=Math.max(10,this.maxMana+a)},c.prototype.destroyManaCrystals=function(a){this.maxMana=Math.max(0,this.maxMana-a),this.mana>this.maxMana&&(this.mana=this.maxMana)},c.prototype.hasCardsLeft=function(){return this.library.size()>0},c.prototype.handleOutOfCards=function(){},c.prototype.isHandFull=function(){return this.hand.size()>=a.Game.MAXIMUM_HAND_SIZE},c.prototype.handleFullHand=function(){},c.prototype.isBoardFull=function(){return this.board.length>=a.Game.MAXIMUM_BOARD_SIZE},c.prototype.drawCard=function(){if(!this.hasCardsLeft())return void this.handleOutOfCards();if(this.isHandFull())return void this.handleFullHand();var a=this.library.removeElementAtIndex(0);this.hand.add(a),this.onEvent(8,a,null)},c.prototype.drawCardNamed=function(b){if(!this.hasCardsLeft())return void this.handleOutOfCards();if(this.isHandFull())return void this.handleFullHand();var c=a.Card.get(b);null!=c&&this.hand.add(new a.Spell(c,this))},c.prototype.castSpell=function(a){this.castSpellBeforeMinion(a,null)},c.prototype.castSpellBeforeMinion=function(a,b){this.mana-=a.getCost(),this.overload+=a.card.overload,this.hand.remove(a),this.game.spellCounter++,0==a.card.type?this.handleCastMinion(a,b):2==a.card.type?this.handleCastWeapon(a,b):this.handleCastSpell(a,b)},c.prototype.handleCastMinion=function(b,c){if(!this.isBoardFull()){var d=new a.Minion(b.card.name,b.card.attack,b.card.health,b.card,this),e=this.board.indexOf(c);e>=0?this.board.splice(e,0,d):this.board.push(d),d.onEvent(6,d,null),d.onEvent(10,d,null),this.game.minionCounter++}},c.prototype.handleCastWeapon=function(b){this.weapon=new a.Weapon(b.card.name,b.card.attack,b.card.durability,b.card,this),this.onEvent(6,b,null),this.game.invoke(b.card.onCast,this.weapon,null)},c.prototype.handleCastSpell=function(a){this.onEvent(6,a,null),this.game.invoke(a.card.onCast,a,null)},c.prototype.summonMinionNamed=function(b){if(this.isBoardFull())return void console.log("Shouldn't be here.");var c=a.Card.get(b),d=new a.Minion(c.name,c.attack,c.health,c,this);this.board.push(d),this.game.invoke(c.onCast,d,null),d.onEvent(10,d,null)},c.prototype.equipWeaponNamed=function(b){var c=a.Card.get(b);this.weapon=new a.Weapon(c.name,c.attack,c.durability,c,this)},c.prototype.hasTaunt=function(){var a=!1;return _.each(this.board,function(b){b.taunt&&!b.stealth&&(a=!0)}),a},c.prototype.hasWeapon=function(){return null!=this.weapon&&this.weapon.durability>0},c.prototype.discardRandomCount=function(a){var b=this;_.times(a,function(){if(b.hand.size()>0)var a=Math.floor(Math.random()*b.hand.size());b.discardSpell(b.hand[a])})},c.prototype.discardSpell=function(a){this.hand.remove(a)},c.prototype.useAbility=function(){this.mana-=this.ability.cost,this.abilityUsed=!0,this.game.invoke(this.ability.onCast,this,null)},c.prototype.addSecretAura=function(b){var c=a.Aura.createTriggerable(this,b);return this.secrets.add(c),c},c}(a.Character);a.Player=b}(Dimension||(Dimension={}));var Dimension;!function(a){!function(a){a[a.BASIC=0]="BASIC",a[a.COMMON=1]="COMMON",a[a.RARE=2]="RARE",a[a.EPIC=3]="EPIC",a[a.LEGENDARY=4]="LEGENDARY"}(a.CardRarity||(a.CardRarity={}));a.CardRarity;!function(a){a[a.MINION=0]="MINION",a[a.SPELL=1]="SPELL",a[a.WEAPON=2]="WEAPON",a[a.ABILITY=3]="ABILITY"}(a.CardType||(a.CardType={}));a.CardType;!function(a){a[a.GENERAL=0]="GENERAL",a[a.BEAST=1]="BEAST",a[a.DEMON=2]="DEMON",a[a.DRAGON=3]="DRAGON",a[a.MURLOC=4]="MURLOC",a[a.PIRATE=5]="PIRATE",a[a.TOTEM=6]="TOTEM"}(a.CardSubType||(a.CardSubType={}));var b=(a.CardSubType,function(a){function b(){a.call(this),this.overload=0,this.durabilityLoss=1}return __extends(b,a),b.create=function(a){var c=new b;return a(c),b._cards.setValue(c.name,c),b.get(c.name)},b.get=function(a){return b._cards.copyValue(a)},b._cards=new Collections.Dictionary,b}(a.Triggerable));a.Card=b}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(){function b(){this.spells=new Collections.LinkedList}return b.fromString=function(c){var d=new b,e=c.split("\n");d.hero=e.shift();for(var f,g=0,h=e.length;h>g;g++){f=e[g];var i=f.split("x "),j=a.Card.get(i[1].trim());null!=j&&_.times(~~i[0].trim(),function(){d.spells.add(j)})}return d},b}();a.Deck=b}(Dimension||(Dimension={}));var Dimension;!function(a){"use strict";!function(a){a[a.CAST_SPELL=0]="CAST_SPELL",a[a.ATTACK=1]="ATTACK",a[a.TARGET=2]="TARGET",a[a.SUMMON=3]="SUMMON",a[a.CHOOSE_ONE=4]="CHOOSE_ONE",a[a.MULLIGAN=5]="MULLIGAN"}(a.GameState||(a.GameState={}));a.GameState;!function(a){a[a.ATTACK=0]="ATTACK",a[a.DAMAGE=1]="DAMAGE",a[a.DAMAGE_DEALT=2]="DAMAGE_DEALT",a[a.START_OF_TURN=3]="START_OF_TURN",a[a.END_OF_TURN=4]="END_OF_TURN",a[a.DEATH=5]="DEATH",a[a.CAST=6]="CAST",a[a.HEAL=7]="HEAL",a[a.DRAW=8]="DRAW",a[a.SECRET_REVEALED=9]="SECRET_REVEALED",a[a.SUMMON=10]="SUMMON"}(a.GameEvent||(a.GameEvent={}));a.GameEvent;!function(a){a[a.HERO=0]="HERO",a[a.MINION=1]="MINION",a[a.ENEMY_HERO=2]="ENEMY_HERO",a[a.ENEMY_MINION=3]="ENEMY_MINION",a[a.FRIENDLY_HERO=4]="FRIENDLY_HERO",a[a.FRIENDLY_MINION=5]="FRIENDLY_MINION",a[a.ENEMY=6]="ENEMY",a[a.FRIENDLY=7]="FRIENDLY",a[a.CHARACTER=8]="CHARACTER",a[a.DAMAGED=9]="DAMAGED"}(a.TargetFilter||(a.TargetFilter={}));var b=(a.TargetFilter,function(){function b(){this.players=new Array,this.currentPlayerIndex=0,this.state=5,this.globalAuras=new Collections.LinkedList,this.spellCounter=0,this.turnCounter=0,this.minionCounter=0;var b=this;this.targetFilters={},this.targetFilters[0]=function(){return this instanceof a.Player},this.targetFilters[1]=function(){return this instanceof a.Minion},this.targetFilters[2]=function(b){return this instanceof a.Player&&this!=b.currentPlayer()},this.targetFilters[3]=function(b){return this instanceof a.Minion&&this.controller!=b.currentPlayer()},this.targetFilters[4]=function(b){return this instanceof a.Player&&this.controller==b.currentPlayer()},this.targetFilters[5]=function(b){return this instanceof a.Minion&&this.controller==b.currentPlayer()},this.targetFilters[8]=function(){return b.filter(this,0)||b.filter(this,1)},this.targetFilters[9]=function(){return this.isDamaged()}}return b.prototype.filter=function(a,b){return this.targetFilters[b].call(a,this)},b.prototype.currentPlayer=function(){return this.players[this.currentPlayerIndex]
},b.prototype.currentOpponent=function(){return this.players[this.currentPlayerIndex+1%this.players.length]},b.prototype.init=function(){this.state=5,this.currentPlayerIndex=0,this.currentPlayer().opponent=this.currentOpponent(),this.currentOpponent().opponent=this.currentPlayer();for(var a=0,b=this.players.length;b>a;a++)for(var c=this.players[a];c.hand.size()<3;)c.drawCard();this.currentOpponent().drawCard()},b.prototype.start=function(){this.state=0,this.currentPlayer().mana=1,this.currentPlayer().maxMana=1;for(var a=0,b=this.players.length;b>a;a++)for(var c=this.players[a];c.hand.size()<4;)c.drawCard()},b.prototype.endTurn=function(){this.removeExpiredAuras(),this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.players.length,0==this.currentPlayerIndex&&this.turnCounter++,this.spellCounter=0,this.minionCounter=0;var a=this.currentPlayer();a.maxMana<10&&a.maxMana++,a.mana=a.maxMana-a.overload,a.overload=0,a.attackCount=0,_.each(a.board,function(a){a.sick=!1,a.attackCount=0}),a.abilityUsed=!1,a.drawCard(),_.each(this.players,function(a){a.onEvent(3,a,null),_.each(a.board,function(a){a.onEvent(3,a,null)})})},b.prototype.combat=function(b,c){b.attackCount++,b.stealth=!1,b.onEvent(0,b,c);var d=b.getAttack(),e=c instanceof a.Minion?c.getAttack():0;d>0&&(b.onEvent(2,c,b),c.combatDamage(d,b),c.onEvent(1,b,c)),e>0&&(c.onEvent(2,b,c),b.combatDamage(e,c),b.onEvent(1,b,c)),this.postDamage(),b instanceof a.Player&&b.hasWeapon()&&b.weapon.decayDurability(1)},b.prototype.postDamage=function(){_.each(this.players,function(a){_.each(a.board,function(a){if(a.getHealth()<=0){var b=a.controller.board.indexOf(a);a.controller.board.splice(b,1),a.onEvent(5,a,null)}})})},b.prototype.aurasByStat=function(a){for(var b=new Collections.LinkedList,c=0,d=this.globalAuras.size();d>c;c++){var e=this.globalAuras[c];e.stat==a&&b.add(e)}return b},b.prototype.sumAurasByStat=function(a){for(var b=0,c=this.aurasByStat(a),d=0,e=c.size();e>d;d++)b+=c[d].amountFor(this);return b},b.prototype.removeExpiredAuras=function(){for(var b=new Collections.LinkedList,c=0,d=this.players.length;d>c;c++){var e=this.players[c];b.add(e);for(var f=0,g=e.board.length;g>f;f++)b.add(e.board[f])}for(var h=0,i=b.size();i>h;h++){var j=b[h];j.controller==this.currentPlayer()&&j.unfreeze(),j.onEvent(4,j,null);var k=function(a){a.forEach(function(b){return b.expires&&a.remove(b),!0})};if(k(this.globalAuras),k(j.auras),j instanceof a.Player){var e=j;e.hasWeapon()&&k(e.weapon.auras)}}},b.prototype.removeAura=function(a){this.globalAuras.remove(a);for(var b=0,c=this.players.length;c>b;b++){var d=this.players[b];d.secrets.remove(a),d.auras.remove(a);for(var e=0,f=d.board.length;f>e;e++){var g=d.board[e];g.auras.remove(a)}}},b.prototype.invoke=function(a,b,c){return null!=a?a.apply(this,[b,c]):null},b.prototype.validTargetsWithFilter=function(a){var b=this,c=new Collections.LinkedList;return _.each(this.players,function(d){1==b.filter(d,a)&&c.add(d),_.each(d.board,function(d){d.shroud||1!=b.filter(d,a)||c.add(d)})}),c},b.prototype.targetsCountWithFilter=function(a){return this.validTargetsWithFilter(a).size()},b.prototype.chooseTarget=function(a,b){0!=this.targetsCountWithFilter(a)&&(this.activeFilter=a,this.onTargetHandler=b,this.state=2)},b.prototype.chooseOne=function(){},b.prototype.hasCombo=function(){return this.spellCounter>=1},b.prototype.forEachTargetWithFilter=function(a,b){var c=this.validTargetsWithFilter(a),d=c.toArray();this.forEachTarget(d,b)},b.prototype.forNumberOfRandomTargetsWithFilter=function(a,b,c){var d=this.validTargetsWithFilter(b),e=d.toArray();this.forEachTarget(_.sample(e,a),c)},b.prototype.forEachTargetWithFilterExceptRandom=function(a,b,c){var d=this.validTargetsWithFilter(b),e=d.toArray();this.forEachTarget(_.sample(e,d.size()-a),c)},b.prototype.forEachTarget=function(a,b){var c=this;_.each(a,function(a){a.getHealth()>0&&c.invoke(b,a,null)})},b.prototype.assignDamageForEach=function(a,b,c){_.each(a,function(a){a.combatDamage(b,c),a.onEvent(1,a,c)}),this.postDamage()},b.prototype.damageForEachWithFilter=function(a,b,c){var d=this.validTargetsWithFilter(a),e=d.toArray();this.assignDamageForEach(e,b,c)},b.prototype.spellDamageForEachWithFilter=function(a,b,c){b+=c.owner.sumAurasByStat(9);var d=this.validTargetsWithFilter(a),e=d.toArray();this.assignDamageForEach(e,b,c)},b.prototype.damageForNumberOfRandom=function(a,b,c,d){var e=this.validTargetsWithFilter(b),f=e.toArray();this.assignDamageForEach(_.sample(f,a),c,d)},b.prototype.spellDamageForNumberOfRandom=function(a,b,c,d){c+=d.owner.sumAurasByStat(9);var e=this.validTargetsWithFilter(b),f=e.toArray();this.assignDamageForEach(_.sample(f,a),c,d)},b.MAXIMUM_BOARD_SIZE=7,b.MAXIMUM_HAND_SIZE=10,b}());a.Game=b}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(){function a(a,b){this.card=a,this.owner=b}return a.prototype.getCost=function(){return 0},a}();a.Spell=b}(Dimension||(Dimension={}));var Dimension;!function(a){!function(a){a[a.NONE=0]="NONE",a[a.ATTACK=1]="ATTACK",a[a.HEALTH=2]="HEALTH",a[a.MANA=3]="MANA",a[a.TAUNT=4]="TAUNT",a[a.CHARGE=5]="CHARGE",a[a.WINDFURY=6]="WINDFURY",a[a.DIVINE_SHIELD=7]="DIVINE_SHIELD",a[a.COST=8]="COST",a[a.SPELL_POWER=9]="SPELL_POWER"}(a.Stat||(a.Stat={}));a.Stat}(Dimension||(Dimension={}));var Dimension;!function(a){var b=function(a){function b(b,c,d,e,f){a.call(this,f.game),this.durabilityLoss=1,this.card=e,this.owner=this.controller=f,this.attack=c,this.durability=d,this.durabilityLoss=e.durabilityLoss}return __extends(b,a),b.prototype.getAttack=function(){return Math.max(0,this.attack+this.sumAurasByStat(1))},b.prototype.decayAttack=function(a){this.attack=Math.max(0,this.attack-a)},b.prototype.decayDurability=function(a){-1==a&&(a=this.durabilityLoss),this.durability-=a,this.durability<=0&&this.owner.weapon==this&&this.destroy()},b.prototype.gainDurability=function(a){this.durability+=a},b.prototype.destroy=function(){this.removeAuras(),this.owner.weapon=null},b}(a.GameObject);a.Weapon=b}(Dimension||(Dimension={}));